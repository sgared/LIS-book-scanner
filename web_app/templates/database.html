<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Database View - LIS Book Scanner</title>

    <!-- Bootstrap CSS -->
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css"
      rel="stylesheet"
    />

    <!-- Google Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
      href="https://fonts.googleapis.com/css2?family=Playfair+Display:wght@700;900&display=swap"
      rel="stylesheet"
    />

    <!-- Custom CSS -->
    <link
      href="{{ url_for('static', filename='style.css') }}"
      rel="stylesheet"
    />
  </head>

  <body class="bg-light">
    <div class="container-fluid py-4">
      <!-- Header Section -->
      <div class="text-center mb-5">
        <h2 class="display-5 fw-bold text-primary">ğŸ—„ï¸ Database View</h2>
        <p class="lead">Complete catalog database records</p>
      </div>

      <!-- Navigation -->
      <div class="text-center mb-4">
        <a href="/" class="btn btn-outline-primary me-2">ğŸ  Home</a>
        <a href="/analytics" class="btn btn-outline-warning me-2">ğŸ“Š Analytics</a>
        <a href="/download/csv" class="btn btn-outline-success me-2">ğŸ’¾ Export CSV</a>
        <a href="/download/json" class="btn btn-outline-info">ğŸ“„ Export JSON</a>
      </div>

      {% if error %}
      <div class="alert alert-danger" role="alert">
        <strong>Error:</strong> {{ error }}
      </div>
      {% elif not results %}
      <div class="alert alert-info text-center" role="alert">
        <h4>ğŸ“š No books in database yet</h4>
        <p>Start by <a href="/" class="btn btn-primary">scanning some books</a>!</p>
      </div>
      {% else %}

      <!-- Database Records -->
      <div class="card">
        <div class="card-header d-flex justify-content-between align-items-center">
          <h4 class="mb-0">ğŸ“‹ All Records ({{ results|length }} books)</h4>
          <small class="text-muted">Ordered by most recent first</small>
        </div>
        <div class="card-body">
          <div class="table-responsive">
            <table class="table table-striped table-hover">
              <thead class="table-dark">
                <tr>
                  <th>ID</th>
                  <th>Book ID</th>
                  <th>Title</th>
                  <th>Author</th>
                  <th>Publisher</th>
                  <th>Year</th>
                  <th>ISBN</th>
                  <th>Enriched</th>
                  <th>Added</th>
                </tr>
              </thead>
              <tbody>
                {% for result in results %}
                <tr>
                  <td><span class="badge bg-secondary">{{ result.id or result.get('rowid', loop.index) }}</span></td>
                  <td>{{ result.book_id or 'N/A' }}</td>
                  <td>
                    <strong>{{ result.title or 'Unknown Title' }}</strong>
                    {% if result.get('keywords') %}
                    <br><small class="text-muted">Keywords: {{ result.keywords[:50] }}{% if result.keywords|length > 50 %}...{% endif %}</small>
                    {% endif %}
                  </td>
                  <td>{{ result.author or 'Unknown' }}</td>
                  <td>{{ result.publisher or 'Unknown' }}</td>
                  <td>
                    {% if result.year and result.year != 'Unknown' %}
                    <span class="badge bg-info">{{ result.year }}</span>
                    {% else %}
                    <span class="text-muted">Unknown</span>
                    {% endif %}
                  </td>
                  <td>
                    {% if result.isbn and result.isbn != 'N/A' %}
                    <code>{{ result.isbn }}</code>
                    {% else %}
                    <span class="text-muted">N/A</span>
                    {% endif %}
                  </td>
                  <td>
                    {% if result.enriched and 'Yes' in result.enriched %}
                    <span class="badge bg-success">âœ“ API</span>
                    {% else %}
                    <span class="badge bg-secondary">OCR</span>
                    {% endif %}
                  </td>
                  <td>
                    {% if result.created_at %}
                    <small>{{ result.created_at[:19] }}</small>
                    {% else %}
                    <small class="text-muted">Unknown</small>
                    {% endif %}
                  </td>
                </tr>
                {% endfor %}
              </tbody>
            </table>
          </div>

          {% if results|length > 20 %}
          <div class="text-center mt-3">
            <small class="text-muted">Showing all {{ results|length }} records</small>
          </div>
          {% endif %}
        </div>
      </div>

      <!-- Summary Statistics -->
      <div class="row g-4 mt-4">
        <div class="col-md-3">
          <div class="card text-center">
            <div class="card-body">
              <h5 class="card-title">ğŸ“Š Total Records</h5>
              <h2 class="text-primary">{{ results|length }}</h2>
            </div>
          </div>
        </div>
        <div class="col-md-3">
          <div class="card text-center">
            <div class="card-body">
              <h5 class="card-title">ğŸŒ API Enriched</h5>
              <h2 class="text-success">{{ results|selectattr('enriched')|selectattr('enriched', 'containing', 'Yes')|list|length }}</h2>
            </div>
          </div>
        </div>
        <div class="col-md-3">
          <div class="card text-center">
            <div class="card-body">
              <h5 class="card-title">ğŸ“š With ISBN</h5>
              <h2 class="text-info">{{ results|rejectattr('isbn', 'equalto', 'N/A')|rejectattr('isbn', 'none')|list|length }}</h2>
            </div>
          </div>
        </div>
        <div class="col-md-3">
          <div class="card text-center">
            <div class="card-body">
              <h5 class="card-title">âœï¸ Known Authors</h5>
              <h2 class="text-warning">{{ results|rejectattr('author', 'equalto', 'Unknown')|rejectattr('author', 'equalto', 'Unknown Author')|rejectattr('author', 'none')|list|length }}</h2>
            </div>
          </div>
        </div>
      </div>

      {% endif %}
    </div>

    <!-- Bootstrap JS -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
  </body>
</html>